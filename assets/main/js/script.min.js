import{preloadImages}from"../../libs/utils.js";$=jQuery;let lenis=new Lenis;function handlePageVisibilityAndFavicon(){let e=document.title,a,o=!1;function n(e){let t=document.querySelector("link[rel~='icon']");t||((t=document.createElement("link")).rel="icon",t.type="image/svg+xml",document.head.appendChild(t)),t.href=e+"?v="+(new Date).getTime()}document.addEventListener("visibilitychange",function(){if(document.hidden){if(document.title="Behind The Volt",!o){o=!0;var r=window.location.origin;let e=[r+"/wp-content/themes/btv/assets/images/use/favicon-black.svg",r+"/wp-content/themes/btv/assets/images/use/favicon-blue.svg",r+"/wp-content/themes/btv/assets/images/use/favicon-white.svg"],t=0;a=setInterval(()=>{n(e[t]),t=(t+1)%e.length},500)}}else document.title=e,clearInterval(a),o=!1,n(window.location.origin+"/wp-content/themes/btv/assets/images/use/favicon-white.svg")})}function footer(){var e,t,r=document.getElementById("footerLine");r?(e=r.getContext("2d"),r.width=window.innerWidth,r.height=50,t=r.width,r=r.height,e.clearRect(0,0,t,r),e.strokeStyle="#00FFFF",e.lineWidth=2,e.beginPath(),e.moveTo(0,5),e.lineTo(.17*t,5),e.lineTo(.25*t,40),e.lineTo(t,40),e.stroke()):console.warn("Canvas not found!")}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0),document.addEventListener("DOMContentLoaded",()=>{handlePageVisibilityAndFavicon()});let splitTextInstances=[];function animationText(){splitTextInstances.forEach(e=>e.revert()),splitTextInstances.length=0,gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-heading").forEach(e=>{e.dataset.start;var t=new SplitText(e,{type:"words, chars",charsClass:"char",wordsClass:"word"});splitTextInstances.push(t),gsap.fromTo(t.chars,{filter:"blur(10px)",y:10,willChange:"filter, transform",opacity:0,skewX:"-3deg"},{ease:"power3.out",filter:"blur(0px)",y:0,skewX:"0deg",stagger:.05,opacity:1,duration:2,scrollTrigger:{trigger:e,start:"top 60%"}})}),gsap.utils.toArray(".effect-description").forEach(e=>{var t=new SplitText(e,{type:"lines",linesClass:"line",mask:"lines"});splitTextInstances.push(t),gsap.fromTo(t.lines,{y:40,willChange:"transform"},{y:0,duration:2,ease:"power3.out",stagger:.05,scrollTrigger:{trigger:e,start:"top 60%"}})}),gsap.utils.toArray(".effect-fade-up").forEach(e=>{var t=parseFloat(e.dataset.start)||"50%";gsap.fromTo(e,{y:20,opacity:0,willChange:"transform"},{y:0,duration:1,opacity:1,ease:"power3.out",scrollTrigger:{trigger:e,start:`top ${t}%`}})})}let splitTextInstancesAuto=[];function animationTextAuto(){splitTextInstancesAuto.forEach(e=>e.revert()),splitTextInstancesAuto.length=0,gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-heading-auto").forEach(e=>{e=new SplitText(e,{type:"words, chars",charsClass:"char",wordsClass:"word"});splitTextInstancesAuto.push(e),gsap.fromTo(e.chars,{filter:"blur(10px)",y:10,willChange:"filter, transform",opacity:0,skewX:"-3deg"},{ease:"power3.out",filter:"blur(0px)",y:0,skewX:"0deg",stagger:.05,opacity:1,duration:2})}),gsap.utils.toArray(".effect-description-auto").forEach(e=>{e=new SplitText(e,{type:"lines",linesClass:"line",mask:"lines"});splitTextInstancesAuto.push(e),gsap.fromTo(e.lines,{y:40,willChange:"transform"},{y:0,duration:2,ease:"power3.out",stagger:.05})}),gsap.utils.toArray(".effect-fade-up-auto").forEach(e=>{r,gsap.fromTo(e,{y:20,opacity:0,willChange:"transform"},{y:0,duration:1,opacity:1,ease:"power3.out",delay:1.5})})}function animateTextKaraoke(){$(".effect-karaoke").length<1||(gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-karaoke").forEach(e=>{var t=new SplitText(e,{type:"words, chars",wordsClass:"word",charsClass:"char"});gsap.to(t.chars,{color:"#00ffff",duration:.6,stagger:.05,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 90%",end:"top 30%",scrub:!0}})}))}function animation(){gsap.utils.toArray(".parallax-trigger").forEach(e=>{var t=e.querySelector("img, video");t&&gsap.timeline({scrollTrigger:{trigger:e,scrub:!0,pin:!1}}).fromTo(t,{yPercent:-10,ease:"none"},{yPercent:10,ease:"none"})}),gsap.utils.toArray(".fade-in-img").forEach(e=>{gsap.fromTo(e,{autoAlpha:0},{autoAlpha:1,duration:1,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 50%",end:"bottom 30%"}})}),gsap.utils.toArray(".effect-fade-in").forEach(e=>{var t=e.getAttribute("data-start")||"70%",r=e.getAttribute("data-delay")||"0";gsap.fromTo(e,{opacity:0,y:20},{opacity:1,y:0,duration:1,delay:r,ease:"power1.out",scrollTrigger:{trigger:e,start:"top "+t,end:"bottom "+t}})})}function magicCursor(){if(!(window.innerWidth<991)){var a=document.querySelector(".magic-cursor");document.addEventListener("click",e=>{a.classList.add("scale-in"),setTimeout(()=>{a.classList.remove("scale-in")},500)}),gsap.set(a,{xPercent:-50,yPercent:-50,opacity:0});let t,r;window.addEventListener("mousemove",e=>{t=e.clientX,r=e.clientY,gsap.to(a,{x:t,y:r,opacity:1,duration:.1})}),document.addEventListener("mouseout",function(e){e.relatedTarget||e.toElement||gsap.to(a,{opacity:0,duration:.2})}),document.addEventListener("mouseover",function(){gsap.to(a,{opacity:1,duration:.2})});var e=document.querySelectorAll("[data-cursor-text],a[href]"),o=document.querySelector(".magic-cursor .cursor");e.forEach(e=>{e.addEventListener("mouseenter",()=>{o.classList.add("active")}),e.addEventListener("mouseleave",()=>{o.classList.remove("active")})})}}function header(){let t=document.querySelector(".header-hambuger"),r=document.querySelector(".header-menu"),a=document.querySelector("li.menu-item-has-children"),o=gsap.timeline({paused:!0});o.from(".header-menu-container > ul > li",{y:50,opacity:0,filter:"blur(10px)",stagger:.1,duration:1,ease:"power2.out"}),t.addEventListener("click",()=>{r.classList.contains("active")?(t.classList.remove("active"),o.reverse(),setTimeout(()=>{r.classList.remove("active"),r.classList.add("closing")},1500),setTimeout(()=>{r.classList.remove("closing")},1e3)):(t.classList.add("active"),r.classList.add("active"),r.classList.remove("closing"),setTimeout(()=>{o.restart()},1e3))}),t&&r&&document.addEventListener("click",e=>{t.contains(e.target)||r.contains(e.target)||!r.classList.contains("active")||(t.classList.remove("active"),a.classList.remove("active"),o.reverse(),setTimeout(()=>{r.classList.remove("active"),r.classList.add("closing")},1500),setTimeout(()=>{r.classList.remove("closing")},1e3))}),a.addEventListener("mouseenter",()=>{a.classList.add("active")}),gsap.to(".header",{scrollTrigger:{trigger:"body",start:"top+=100 top",toggleClass:{targets:".header",className:"scrolled"},once:!1}})}function ourService(){function t(e){var t=this.querySelector(".card-item"),r=t.offsetHeight/2;t.style.transform="rotateX("+-(e.offsetY-r)/30+"deg) rotateY("+(e.offsetX-t.offsetWidth/2)/15+"deg)"}function r(e){this.querySelector(".card-item").style.transform="rotate(0)"}$(".our-services").length<1||(document.querySelectorAll(".our-services .card").forEach(e=>{e.addEventListener("mousemove",t),e.addEventListener("mouseout",r)}),992<window.innerWidth&&$(".consultancy .item").on("mouseenter",function(){var e=$(this);e.hasClass("active")||($(".consultancy .item").removeClass("active"),e.addClass("active"),setTimeout(()=>{animationText()},500))}),$(".our-services .card").length<1)||(gsap.registerPlugin(ScrollTrigger),gsap.from(".our-services .card",{yPercent:20,opacity:0,rotate:10,duration:.9,ease:"power2.out",stagger:.3,scrollTrigger:{trigger:".our-services .services-list",start:"top 60%",toggleActions:"play none none none"}}),document.querySelectorAll(".our-services .card").forEach(o=>{let n;function t(e){var t=e.clientX,e=e.clientY,t=t-n.x,e=e-n.y;const r=t-n.width/2,a=e-n.height/2;t=o.querySelector(".glow");t&&(t.style.backgroundImage=`
        radial-gradient(
          circle at
          ${2*r+n.width/2}px
          ${2*a+n.height/2}px,
          #00ffff4D,
          #1c1c1c
        )
      `)}o.addEventListener("mouseenter",()=>{n=o.getBoundingClientRect(),document.addEventListener("mousemove",t)}),o.addEventListener("mouseleave",()=>{document.removeEventListener("mousemove",t);var e=o.querySelector(".glow");e&&(e.style.backgroundImage=`
        radial-gradient(
          circle at 50% -20%,
          #1c1c1c,
          #1c1c1c
        )
      `)})}))}function bannerParallax(){var e=document.querySelector(".banner picture img");gsap.set(e,{transformOrigin:"center center",force3D:!0}),gsap.to(e,{scrollTrigger:{trigger:".banner",start:"top top",end:"bottom 30%",scrub:1,refreshPriority:1},ease:"power3.out",yPercent:5,scale:1.1,force3D:!0})}function particleEffect(){let t=document.getElementById("particles"),r=t.getContext("2d");function e(){t.width=window.innerWidth,t.height=window.innerHeight}e(),window.addEventListener("resize",e);class a{constructor(){this.reset()}reset(){this.x=Math.random()*t.width,this.y=Math.random()*t.height,this.size=2*Math.random()+.5,this.speedX=2*Math.random()-1,this.speedY=2*Math.random()-1,this.opacity=.5*Math.random()+.1}update(){this.x+=this.speedX,this.y+=this.speedY,(this.x<0||this.x>t.width)&&(this.speedX*=-1),(this.y<0||this.y>t.height)&&(this.speedY*=-1)}draw(){r.beginPath(),r.arc(this.x,this.y,this.size,0,2*Math.PI),r.fillStyle=`rgba(255, 255, 255, ${this.opacity})`,r.fill()}}let o=Array.from({length:200},()=>new a),n=0,i=0;document.addEventListener("mousemove",e=>{n=e.clientX,i=e.clientY}),function e(){r.clearRect(0,0,t.width,t.height),o.forEach(e=>{e.update(),e.draw()}),o.forEach((e,t)=>{var r=e.x-n,a=e.y-i,o=Math.sqrt(r*r+a*a);o<150&&(a=Math.atan2(a,r),r=(150-o)/150,e.x+=Math.cos(a)*r*2,e.y+=Math.sin(a)*r*2)}),requestAnimationFrame(e)}()}function effectImgParallaxAndMove(){gsap.utils.toArray(".img-move-parallax").forEach(e=>{var t=e.querySelector("img"),r=e.classList.contains("move-reverse");gsap.set(e,{xPercent:r?-50:50,autoAlpha:0}),gsap.set(t,{yPercent:-15,scale:1.35}),gsap.timeline({scrollTrigger:{trigger:e,start:"top 50%",end:"center 50%"}}).to(e,{xPercent:0,autoAlpha:1,duration:1.5,ease:"power3.out"}),gsap.timeline({scrollTrigger:{trigger:e,start:"center 70%",end:"bottom 20%",scrub:1}}).to(t,{yPercent:10,scale:1.2})})}function formCard(){let e=document.querySelectorAll(".contact-form");e.length&&document.querySelector(".contact-right").addEventListener("mousemove",a=>{e.forEach(e=>{var t=e.getBoundingClientRect(),r=a.clientX-t.left,t=a.clientY-t.top;e.style.setProperty("--mouse-x",r+"px"),e.style.setProperty("--mouse-y",t+"px")})})}function fadeTextFooter(){gsap.set("data-text-footer",{opacity:0,y:20});var e=gsap.timeline({paused:!0});return e.fromTo("[data-text-footer]",{opacity:0,y:20},{opacity:1,y:0,stagger:.05,duration:.6,ease:"power2.out"}),ScrollTrigger.create({trigger:"footer",start:"top 80%",animation:e,toggleActions:"play none none none"}),e}function modalVideoHighLight(){var r=document.getElementById("btvHighlight");if(r){let e=r.querySelector("video"),t=(r.addEventListener("shown.bs.modal",function(){e&&(e.muted=!1,e.currentTime=0,e.play())}),r.addEventListener("hidden.bs.modal",function(){e&&(e.pause(),e.currentTime=0,e.muted=!0)}),document.getElementById("btnModalHighlight"));r=document.getElementById("footer");t&&r&&(gsap.registerPlugin(ScrollTrigger),ScrollTrigger.create({trigger:r,start:"top bottom",onEnter:()=>{gsap.to(t,{opacity:0,pointerEvents:"none",duration:.4,ease:"none"})},onLeaveBack:()=>{gsap.to(t,{opacity:1,pointerEvents:"auto",duration:.4,ease:"none"})}}))}}function moveDots(){document.querySelectorAll(".dot-pattern").forEach(o=>{let n=o.querySelector(".dot-overlay"),i=12,s=[];function e(){n.innerHTML="",s=[];var r=o.getBoundingClientRect();for(let t=i;t<r.width;t+=i)for(let e=i;e<r.height;e+=i){var a=document.createElement("div");a.className="interactive-dot",a.style.transform=`translate(${t}px, ${e}px) scale(1)`,a.style.opacity="0.4",n.appendChild(a),s.push({element:a,originalX:t,originalY:e,currentX:t,currentY:e})}}e();let t=!1,l=0,c=0,r;function a(){s.forEach(e=>{var t,r=l-e.originalX,a=c-e.originalY,o=Math.sqrt(r*r+a*a);o<80?(t=15*(o=Math.max(0,1-o/80)),a=Math.atan2(a,r),e.currentX=e.originalX+Math.cos(a)*t,e.currentY=e.originalY+Math.sin(a)*t,r=.4+.6*o,e.element.style.transform=`translate(${e.currentX}px, ${e.currentY}px) scale(${1+1.5*o})`,e.element.style.opacity=r,e.element.classList.add("moving")):(e.currentX=e.originalX,e.currentY=e.originalY,e.element.style.transform=`translate(${e.originalX}px, ${e.originalY}px) scale(1)`,e.element.style.opacity="0.4",e.element.classList.remove("moving"))}),r=null}o.addEventListener("mouseenter",()=>{t=!0}),o.addEventListener("mousemove",function(e){var t=o.getBoundingClientRect();l=e.clientX-t.left,c=e.clientY-t.top,r=r||requestAnimationFrame(a)}),o.addEventListener("mouseleave",()=>{t=!1,r&&(cancelAnimationFrame(r),r=null),s.forEach(e=>{e.element.style.transform=`translate(${e.originalX}px, ${e.originalY}px) scale(1)`,e.element.style.opacity="0.4",e.element.classList.remove("moving"),e.currentX=e.originalX,e.currentY=e.originalY})});let d;window.addEventListener("resize",()=>{clearTimeout(d),d=setTimeout(()=>{t||e()},200)})})}function contactForm(){if(!($(".contact-form").length<1)){let r=$("#contact-form"),a=r.find("input[name='name']"),o=r.find("input[name='email']"),n=r.find("input[name='phone']"),i=r.find("#terms"),s=r.find("textarea[name='message']"),l=r.find("button[type='submit']");function c(){i.is(":checked")?l.prop("disabled",!1):l.prop("disabled",!0)}i.on("change",c),r.on("submit",function(e){e.preventDefault(),r.find("input, textarea").removeClass("error");let t=!0;a.val().trim()||(a.addClass("error"),t=!1),o.val().trim()||(o.addClass("error"),t=!1),n.val().trim()||(n.addClass("error"),t=!1),(t=i.is(":checked")?t:!1)&&$.ajax({type:"POST",url:ajaxUrl,data:{action:"submit_contact_form",name:a.val().trim(),email:o.val().trim(),phone:n.val().trim(),messageNote:s.val().trim()},beforeSend:function(){l.addClass("aloading")},success:function(e){r[0].reset(),c(),0<r.find(".form-checked-container").length&&(r.find(".success-message").show(),setTimeout(function(){r.find(".success-message").hide()},5e3)),l.removeClass("aloading")},error:function(e,t,r){console.error("Lỗi khi gửi form:",r)}})})}}function getNewletter(){function n(e,t,r){e.removeClass("success error").addClass(r?"success":"error").text(t).show()}$("#form-newletter").on("submit",function(e){e.preventDefault();let t=$(this),r=t.find("input[type='email']"),a=t.find("button[type='submit']"),o=t.siblings(".newsletter-message");r.removeClass("error"),o.removeClass("success error").text("").hide(),r.length?(e=r.val()?r.val().trim():"")?$.ajax({type:"POST",url:ajaxUrl,data:{action:"btv_receive_newletter",email:e},beforeSend:function(){a.addClass("aloading"),o.removeClass("success error").text("").hide()},success:function(e){a.removeClass("aloading"),!0===e.status?(t[0].reset(),n(o,e.message,!0)):(r.addClass("error"),n(o,e.message,!1)),setTimeout(()=>{o.hide()},5e3)},error:function(){a.removeClass("aloading"),n(o,"An error occurred. Please try again later.",!1)}}):(r.addClass("error"),n(o,"Please enter your email.",!1)):console.error("Không tìm thấy input email trong form.")})}document.addEventListener("DOMContentLoaded",function(){bannerParallax()});let init=()=>{gsap.registerPlugin(ScrollTrigger),animationText(),formCard(),particleEffect(),animateTextKaraoke(),footer(),animationTextAuto(),magicCursor(),header(),ourService(),animation(),effectImgParallaxAndMove(),fadeTextFooter(),modalVideoHighLight(),contactForm(),getNewletter(),ScrollTrigger.refresh(!0)};function updateProgressBar(){let e=document.querySelector(".progress-bar");var t=document.body.scrollHeight-window.innerHeight;e.style.height=window.pageYOffset/t*100+"%",e.style.boxShadow=" 0 2px 10px 1px #00ffff",clearTimeout(e.dataset.scrollTimeout),e.dataset.scrollTimeout=setTimeout(()=>{e.style.boxShadow="none"},300)}preloadImages("img").then(()=>{init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)}),updateProgressBar(),window.addEventListener("scroll",updateProgressBar),window.addEventListener("resize",updateProgressBar);